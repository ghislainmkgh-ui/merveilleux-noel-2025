<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merveilleux NoÃ«l 2025 ðŸŽ„âœ¨ CrÃ©Ã© par [GHISLAIN MKGH]</title>
    <style>
        * { box-sizing: border-box; }
        
        body { 
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            background: linear-gradient(to bottom, #001122, #000011); 
            font-family: 'Arial', sans-serif; 
            color: white; 
            cursor: none;
            width: 100vw;
            height: 100vh;
        }
        
        html { width: 100%; height: 100%; }
        
        canvas { display: block; width: 100%; height: 100%; }
        
        #form { 
            position: absolute; 
            top: clamp(8px, 5vh, 80px); 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 100; 
            background: rgba(0,0,0,0.6); 
            padding: clamp(12px, 3vw, 20px); 
            border-radius: 12px; 
            backdrop-filter: blur(8px); 
            width: min(95vw, 900px);
            max-height: 70vh;
            overflow-y: auto;
        }
        
        #pageTitle { 
            position: fixed; 
            top: 8px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 130; 
            font-size: clamp(1rem, 4vw, 1.4rem); 
            text-align: center; 
            -webkit-background-clip: text; 
            color: white;
            padding: 0 10px;
        }
        
        input { 
            background: rgba(255,255,255,0.1); 
            border: 2px solid #ff6b6b; 
            color: white; 
            padding: clamp(8px, 2vw, 10px); 
            border-radius: 10px; 
            margin: 5px auto; 
            width: min(90vw, 300px);
            font-size: clamp(12px, 2vw, 16px);
            display: block;
        }
        
        button { 
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4); 
            border: none; 
            color: white; 
            padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 20px); 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            margin: 5px;
            font-size: clamp(12px, 2vw, 16px);
            white-space: nowrap;
        }
        
        .controls { 
            display: flex; 
            gap: clamp(4px, 2vw, 8px); 
            justify-content: center; 
            align-items: center; 
            flex-wrap: wrap;
            margin: clamp(8px, 2vw, 15px) 0;
        }
        
        .controls button { position: relative; z-index: 110; }
        
        #namesList { 
            margin-top: 10px; 
            max-height: 200px; 
            overflow-y: auto;
        }
        
        .nameItem { 
            background: rgba(255,255,255,0.1); 
            margin: 5px 0; 
            padding: 8px; 
            border-radius: 5px; 
            animation: glow 2s infinite alternate;
            font-size: clamp(12px, 2vw, 16px);
        }
        
        @keyframes glow { 
            0% { box-shadow: 0 0 5px #ff6b6b; } 
            100% { box-shadow: 0 0 20px #4ecdc4; } 
        }
        
        h1 { 
            text-align: center; 
            font-size: clamp(1.2em, 5vw, 2.5em); 
            margin: 20px 0; 
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            animation: rainbow 3s infinite; 
        }
        
        @keyframes rainbow { 
            0%,100%{background-position:0% 50%} 
            50%{background-position:100% 50%} 
        }
        
        #photoCanvas { 
            position: absolute; 
            z-index: 9999;
            border-radius: 50%; 
            box-shadow: 0 0 60px rgba(255,215,0,0.9); 
            left: 50%; 
            top: 45%; 
            transform: translate(-50%, -50%);
            width: min(35vmin, 90vw);
            height: min(35vmin, 90vw);
            max-width: 420px;
            max-height: 420px;
        }
        
        #creatorLabel { 
            position: absolute; 
            z-index: 60; 
            left: 50%; 
            top: 75%; 
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ffd700, #ff6b6b); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            font-size: clamp(16px, 3vw, 28px); 
            font-weight: bold; 
            animation: rainbow 3s infinite; 
            text-shadow: 0 0 20px rgba(255,215,0,0.8);
            padding: 0 10px;
            text-align: center;
            max-width: 90vw;
        }

        /* Tablettes et Ã©crans moyens (481px - 768px) */
        @media (min-width: 481px) and (max-width: 768px) {
            #form { top: clamp(8px, 8vh, 100px); }
            button { padding: 10px 16px; }
        }

        /* Grands Ã©crans (769px et plus) */
        @media (min-width: 769px) {
            #form { top: clamp(60px, 10vh, 120px); }
            button { padding: 12px 24px; }
        }

        /* TrÃ¨s petits Ã©crans (320px - 380px) */
        @media (max-width: 380px) {
            #form { top: 8px; padding: 10px; }
            .controls button { min-width: auto; flex: 1; }
            input { margin: 8px 0; }
        }

        /* Ã‰crans larges (1200px+) */
        @media (min-width: 1200px) {
            #form { width: min(95vw, 1000px); }
        }

        .hat { 
            position: absolute; 
            font-size: clamp(16px, 4vw, 32px); 
            z-index: 120; 
            pointer-events: none; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); 
        }
        
        .hat-top-left { left: clamp(4px, 2vw, 8px); top: clamp(4px, 2vh, 8px); }
        .hat-top-right { right: clamp(4px, 2vw, 8px); top: clamp(4px, 2vh, 8px); }
        .hat-bottom-left { left: clamp(4px, 2vw, 8px); bottom: clamp(4px, 2vh, 8px); }
        .hat-bottom-right { right: clamp(4px, 2vw, 8px); bottom: clamp(4px, 2vh, 8px); }

        /* Orientation portrait vs paysage */
        @media (orientation: portrait) and (max-height: 600px) {
            #form { max-height: 60vh; }
            #photoCanvas { display: none; }
            #creatorLabel { display: none; }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <canvas id="photoCanvas" width="200" height="200"></canvas>
    <div id="creatorLabel">âœ¨ GHISLAIN MKGH vous souhaite joyeux noÃ«l âœ¨</div>
    <div id="pageTitle">ðŸŽ„ Ajoutez les noms des amis pour NoÃ«l 2025 âœ¨</div>
    <div id="form">
        <input type="text" id="nameInput" placeholder="Entrez un nom..." />
        <br>
        <div class="controls">
            <button id="addNameBtn">âž• Ajouter</button>
            <button id="clearBtn">ðŸ§¹ Effacer</button>
            <button id="audioToggle">ðŸ”” Son: Activer</button>
            <button id="uploadBtn" style="display:none;">ðŸ“· Ajouter ma photo</button>
            <button id="uploadMusicBtn" style="display:none;">ðŸŽµ Ajouter musique</button>
        </div>
        <input type="file" id="photoInput" accept="image/*" style="display:none;" onchange="uploadPhoto(event)">
        <input type="file" id="musicInput" accept="audio/*" style="display:none;" onchange="uploadMusic(event)">
        <div id="namesList"></div>
    </div>

    <!-- Petits chapeaux de NoÃ«l aux quatre coins -->
    <div class="hat hat-top-left">ðŸŽ…</div>
    <div class="hat hat-top-right">ðŸŽ…</div>
    <div class="hat hat-bottom-left">ðŸŽ…</div>
    <div class="hat hat-bottom-right">ðŸŽ…</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const photoCanvas = document.getElementById('photoCanvas');
        const photoCtx = photoCanvas.getContext('2d');
        
        // WebAudio synthÃ© festif (dÃ©marrÃ© par dÃ©faut)
        let audioCtx = null;
        let masterGain = null;
        let melodyInterval = null;
        let audioPlaying = false;

        function initAudio() {
            if (audioCtx) return;
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioCtx.createGain();
                masterGain.gain.value = 0.35;
                masterGain.connect(audioCtx.destination);
            } catch (e) {
                console.log('WebAudio non disponible', e);
            }
        }

        function playNote(freq, when, duration = 0.25) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = 'sine';
            o.frequency.value = freq;
            g.gain.setValueAtTime(0.0001, when);
            g.gain.exponentialRampToValueAtTime(0.9, when + 0.01);
            g.gain.exponentialRampToValueAtTime(0.0001, when + duration);
            o.connect(g);
            g.connect(masterGain);
            o.start(when);
            o.stop(when + duration + 0.02);
        }

        function playMelodyOnce() {
            if (!audioCtx) return;
            const now = audioCtx.currentTime;
            // Simple jingle: C4, E4, G4, C5 arpeggio then a little flourish
            const notes = [261.63, 329.63, 392.00, 523.25, 392.00, 329.63];
            for (let i = 0; i < notes.length; i++) {
                playNote(notes[i], now + i * 0.32, 0.28);
            }
        }

        function startMusic() {
            initAudio();
            if (!audioCtx) return false;
            // Resume context for browsers requiring user interaction
            audioCtx.resume().then(() => {
                if (melodyInterval) clearInterval(melodyInterval);
                playMelodyOnce();
                melodyInterval = setInterval(playMelodyOnce, 2200);
                audioPlaying = true;
                const btn = document.getElementById('audioToggle');
                if (btn) btn.textContent = 'ðŸ”” Son: DÃ©sactiver';
            }).catch(() => {
                audioPlaying = false;
            });
            return true;
        }

        function stopMusic() {
            if (melodyInterval) { clearInterval(melodyInterval); melodyInterval = null; }
            audioPlaying = false;
            const btn = document.getElementById('audioToggle');
            if (btn) btn.textContent = 'ðŸ”” Son: Activer';
        }

        let flowers = [];
        let names = [];
        let myPhoto = null;
        let animationId;
        let isCreator = false;
        const CREATOR_PASSWORD = '08450mkgh$';
        // Stockage localStorage pour les noms avec expiration (2 jours = 48h)
        const STORAGE_KEY = 'noel2025_names';
        const EXPIRATION_TIME_MS = 2 * 24 * 60 * 60 * 1000; // 2 jours en ms
        // Musique par dÃ©faut intÃ©grÃ©e
       const defaultMusicPath = 'https://raw.githubusercontent.com/ghislainmkgh-ui/merveilleux-noel-2025/main/On_te_souhaite_un_Joyeux_NoÃ«l_ðŸŽ„_Chanson_de_NoÃ«l____20_min_ðŸŽ…_HeyKids_FranÃ§ais(256k).mp3';
        // Photo par dÃ©faut intÃ©grÃ©e (nom du fichier dans le mÃªme dossier)
        const defaultPhotoPath = 'https://raw.githubusercontent.com/ghislainmkgh-ui/merveilleux-noel-2025/main/mkgh.jpeg';

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            resizePhoto();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Fleurs tombantes
        class Flower {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = -50;
                this.size = Math.random() * 15 + 5;
                this.speedY = Math.random() * 3 + 1;
                this.speedX = Math.random() * 2 - 1;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotSpeed = Math.random() * 0.05;
                this.opacity = Math.random() * 0.5 + 0.3;
                this.swing = Math.random() * Math.PI * 2;
            }
            update() {
                this.y += this.speedY;
                this.x += this.speedX + Math.sin(this.swing) * 0.5;
                this.rotation += this.rotSpeed;
                this.swing += 0.1;
                this.opacity -= 0.001;
                if (this.y > canvas.height || this.opacity <= 0) {
                    this.y = -50;
                    this.opacity = Math.random() * 0.5 + 0.3;
                }
            }
            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
                gradient.addColorStop(0, `hsl(${Math.sin(Date.now() * 0.001 + this.x) * 30 + 340}, 80%, 60%)`);
                gradient.addColorStop(1, 'rgba(255,255,255,0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        // Noms montant du bas (bouclent indÃ©finiment)
        class RisingName {
            constructor(fullText, name) {
                this.fullText = fullText;
                this.name = name;
                this.reset();
                this.speedY = -(Math.random() * 1.2 + 0.6);
            }
            reset() {
                this.y = canvas.height + 50 + Math.random() * 200;
                this.x = Math.random() * canvas.width;
            }
            update() {
                this.y += this.speedY;
                if (this.y < -120) {
                    this.reset();
                }
                return true;
            }
            draw() {
                ctx.save();
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = '#ff6b6b';
                ctx.shadowBlur = 20;
                
                ctx.font = 'bold 28px Arial';
                const gradient = ctx.createLinearGradient(0, 0, 200, 0);
                gradient.addColorStop(0, '#ff6b6b');
                gradient.addColorStop(0.5, '#4ecdc4');
                gradient.addColorStop(1, '#45b7d1');
                ctx.fillStyle = gradient;
                ctx.fillText('Merveilleux NoÃ«l', this.x, this.y - 20);
                
                ctx.font = 'bold 24px Arial';
                ctx.fillStyle = 'rgba(255,255,255,0.95)';
                ctx.shadowBlur = 10;
                ctx.fillText(this.name, this.x, this.y + 10);
                ctx.restore();
            }
        }

        // Gestion photo (autorisÃ© uniquement pour le crÃ©ateur)
        function uploadPhoto(event) {
            if (!isCreator) return alert('Seul le crÃ©ateur peut ajouter une photo');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    myPhoto = new Image();
                    myPhoto.onload = function() {
                        resizePhoto();
                    };
                    myPhoto.src = e.target.result;
                    document.getElementById('photoInput').value = ''; // Reset
                };
                reader.readAsDataURL(file);
            }
        }

        function resizePhoto() {
            if (!myPhoto) return;
            const size = Math.min(canvas.width * 0.35, canvas.height * 0.35, 420);
            photoCanvas.width = size;
            photoCanvas.height = size;
            photoCanvas.style.width = size + 'px';
            photoCanvas.style.height = size + 'px';
        }

        function drawPhoto() {
            if (!myPhoto) return;
            
            photoCtx.clearRect(0, 0, photoCanvas.width, photoCanvas.height);
            
            // Photo avec bordure circulaire
            photoCtx.save();
            photoCtx.beginPath();
            photoCtx.arc(photoCanvas.width/2, photoCanvas.height/2, photoCanvas.width/2 - 5, 0, Math.PI * 2);
            photoCtx.clip();
            photoCtx.drawImage(myPhoto, 0, 0, photoCanvas.width, photoCanvas.height);
            photoCtx.restore();
            
            // Bordure arc-en-ciel rotative
            const time = Date.now() * 0.005;
            const gradient = photoCtx.createRadialGradient(photoCanvas.width/2, photoCanvas.height/2, 0, photoCanvas.width/2, photoCanvas.height/2, photoCanvas.width/2);
            gradient.addColorStop(0, `hsl(${(time * 30) % 360}, 100%, 70%)`);
            gradient.addColorStop(0.7, 'rgba(255,215,0,0.9)');
            gradient.addColorStop(1, 'rgba(255,215,0,0)');
            
            photoCtx.beginPath();
            photoCtx.arc(photoCanvas.width/2, photoCanvas.height/2, photoCanvas.width/2 - 5, 0, Math.PI * 2);
            photoCtx.lineWidth = 8;
            photoCtx.strokeStyle = gradient;
            photoCtx.lineCap = 'round';
            photoCtx.stroke();
            
            // Ã‰toiles scintillantes autour
            for (let i = 0; i < 8; i++) {
                const angle = (time + i * Math.PI / 4) % (Math.PI * 2);
                const starX = photoCanvas.width/2 + Math.cos(angle) * (photoCanvas.width/2 + 20);
                const starY = photoCanvas.height/2 + Math.sin(angle) * (photoCanvas.height/2 + 20);
                photoCtx.fillStyle = `hsl(${(time * 60 + i * 45) % 360}, 100%, 80%)`;
                photoCtx.beginPath();
                photoCtx.arc(starX, starY, 4, 0, Math.PI * 2);
                photoCtx.fill();
            }
        }

        function init() {
            // Charger les noms sauvegardÃ©s d'abord
            loadNamesFromStorage();
            updateList(); // Afficher les noms chargÃ©s
            
            for (let i = 0; i < 120; i++) flowers.push(new Flower());
            // charger la photo par dÃ©faut
            try {
                myPhoto = new Image();
                myPhoto.onload = function() {
                    resizePhoto();
                    console.log('Photo chargÃ©e:', defaultPhotoPath);
                };
                myPhoto.onerror = function() {
                    console.warn('Erreur chargement photo:', defaultPhotoPath);
                    myPhoto = null;
                };
                myPhoto.src = defaultPhotoPath;
            } catch (e) {
                console.error('Exception photo:', e);
            }
            // charger la musique par dÃ©faut (intÃ©grÃ©e)
            try {
                uploadedAudioEl = new Audio(defaultMusicPath);
                uploadedAudioEl.loop = true;
                uploadedAudioEl.volume = 0.6;
                uploadedAudioEl.onerror = function() {
                    console.warn('Erreur chargement musique:', defaultMusicPath);
                };
                // tenter de lancer la musique dÃ¨s l'ouverture
                uploadedAudioEl.play().then(() => {
                    audioPlaying = true;
                    const btn = document.getElementById('audioToggle');
                    if (btn) btn.textContent = 'ðŸ”” Son: DÃ©sactiver';
                }).catch(() => {
                    // fallback au synthÃ© si la politique du navigateur l'exige
                    startMusic();
                });
            } catch (e) {
                console.error('Exception musique:', e);
            }
            // vibration courte au dÃ©marrage (mobile)
            try { if (navigator.vibrate) navigator.vibrate([200,100,200]); } catch (e) {}
            animate();
            resetInactivityTimer();
        }

        function animate() {
            ctx.fillStyle = 'rgba(0,0,20,0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            flowers.forEach(flower => {
                flower.update();
                flower.draw();
            });
            
            if (Math.random() < 0.4) flowers.push(new Flower());
            if (flowers.length > 180) flowers.shift();
            
            names.forEach(name => {
                name.update();
                name.draw();
            });
            
            drawPhoto(); // TOUS voient la photo signature
            
            animationId = requestAnimationFrame(animate);
        }

        function addName() {
            const input = document.getElementById('nameInput');
            const name = input.value.trim();
            if (name) {
                names.push(new RisingName(`Merveilleux NoÃ«l ${name}`, name));
                input.value = '';
                saveNamesToStorage();
                updateList();
            }
        }

        // Sauvegarder les noms dans localStorage avec timestamp
        function saveNamesToStorage() {
            const namesData = names.map(n => ({
                fullText: n.fullText,
                name: n.name,
                timestamp: Date.now()
            }));
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(namesData));
                console.log('Noms sauvegardÃ©s:', namesData.length);
            } catch (e) {
                console.warn('Erreur localStorage:', e);
            }
        }

        // Charger les noms depuis localStorage et nettoyer les expirÃ©s
        function loadNamesFromStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (!stored) return;
                const namesData = JSON.parse(stored);
                const now = Date.now();
                const validNames = [];

                namesData.forEach(item => {
                    // VÃ©rifier si le nom a moins de 2 jours
                    if (now - item.timestamp < EXPIRATION_TIME_MS) {
                        names.push(new RisingName(item.fullText, item.name));
                        validNames.push(item);
                    } else {
                        console.log(`Nom expirÃ© supprimÃ©: ${item.name}`);
                    }
                });

                // Mettre Ã  jour localStorage avec les noms valides
                if (validNames.length !== namesData.length) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(validNames));
                    console.log('Nettoyage localStorage: ' + (namesData.length - validNames.length) + ' nom(s) expirÃ©(s)');
                }
                console.log('Noms chargÃ©s:', validNames.length);
            } catch (e) {
                console.warn('Erreur chargement localStorage:', e);
            }
        }

        function clearNames() {
            names = [];
            try {
                localStorage.removeItem(STORAGE_KEY);
                console.log('Tous les noms ont Ã©tÃ© effacÃ©s');
            } catch (e) {
                console.warn('Erreur suppression localStorage:', e);
            }
            updateList();
        }

        function updateList() {
            const list = document.getElementById('namesList');
            list.innerHTML = names.map(n => `<div class="nameItem">âœ¨ ${n.fullText}</div>`).join('');
        }

        // ContrÃ´les audio, authentification crÃ©ateur (clic droit sur la photo) et gestion d'inactivitÃ©
        const audioToggleBtn = document.getElementById('audioToggle');
        const uploadBtn = document.getElementById('uploadBtn');
        const formEl = document.getElementById('form');

        // audio toggle -> utilise startMusic/stopMusic
        // gestion musique uploadÃ©e (prioritÃ©) ou synthÃ©
        let uploadedAudioEl = null;
        let uploadedAudioURL = null;

        function uploadMusic(event) {
            if (!isCreator) return alert('Seul le crÃ©ateur peut ajouter une musique');
            const file = event.target.files[0];
            if (!file) return;
            if (uploadedAudioEl) {
                try { uploadedAudioEl.pause(); } catch (e) {}
                if (uploadedAudioURL) URL.revokeObjectURL(uploadedAudioURL);
            }
            uploadedAudioURL = URL.createObjectURL(file);
            uploadedAudioEl = new Audio(uploadedAudioURL);
            uploadedAudioEl.loop = true;
            uploadedAudioEl.volume = 0.6;
            alert('Musique chargÃ©e. Elle sera lue par dÃ©faut quand vous activez le son.');
            // show music upload button state
        }

        audioToggleBtn.addEventListener('click', () => {
            if (!audioPlaying) {
                // prefer uploaded audio
                if (uploadedAudioEl) {
                    uploadedAudioEl.play().then(() => {
                        audioPlaying = true;
                        audioToggleBtn.textContent = 'ðŸ”” Son: DÃ©sactiver';
                    }).catch(() => {
                        // fallback to synth
                        startMusic();
                    });
                } else {
                    startMusic();
                }
            } else {
                // stop whatever is playing
                if (uploadedAudioEl) {
                    uploadedAudioEl.pause();
                }
                stopMusic();
            }
        });

        // clic droit (contextmenu) sur le cercle photo pour rÃ©vÃ©ler le login secret
        photoCanvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            const pw = prompt('Mot de passe crÃ©ateur :');
            if (pw === CREATOR_PASSWORD) {
                isCreator = true;
                uploadBtn.style.display = 'inline-block';
                const uploadMusicBtn = document.getElementById('uploadMusicBtn');
                if (uploadMusicBtn) uploadMusicBtn.style.display = 'inline-block';
                alert('ConnectÃ© en tant que crÃ©ateur â€” vous pouvez maintenant ajouter la photo');
            } else if (pw !== null) {
                alert('Mot de passe incorrect');
            }
            return false;
        });

        uploadBtn.addEventListener('click', () => {
            if (isCreator) document.getElementById('photoInput').click();
            else alert('Seul le crÃ©ateur peut ajouter une photo');
        });

        // liaisons boutons Add/Clear
        const addNameBtn = document.getElementById('addNameBtn');
        const clearBtnEl = document.getElementById('clearBtn');
        if (addNameBtn) addNameBtn.addEventListener('click', addName);
        if (clearBtnEl) clearBtnEl.addEventListener('click', clearNames);

        // music upload button
        const musicInput = document.getElementById('musicInput');
        const uploadMusicBtn = document.getElementById('uploadMusicBtn');
        if (uploadMusicBtn) {
            uploadMusicBtn.addEventListener('click', () => {
                if (isCreator) musicInput.click();
                else alert('Seul le crÃ©ateur peut ajouter une musique');
            });
        }

        // InactivitÃ©: masquer les contrÃ´les aprÃ¨s 2 minutes sans interaction
        let inactivityTimer = null;
        const INACTIVITY_MS = 120000; // 2 minutes

        function hideControls() {
            const els = formEl.querySelectorAll('button, input#nameInput');
            els.forEach(el => { el.style.display = 'none'; });
        }

        function showControls() {
            const els = formEl.querySelectorAll('button, input#nameInput');
            els.forEach(el => { el.style.display = ''; });
            // keep uploadBtn visibility according to creator state
            if (!isCreator) uploadBtn.style.display = 'none';
        }

        function resetInactivityTimer() {
            if (inactivityTimer) clearTimeout(inactivityTimer);
            // ensure controls visible while active
            showControls();
            inactivityTimer = setTimeout(() => {
                hideControls();
            }, INACTIVITY_MS);
        }

        // reset timer on interactions
        ['click','mousemove','touchstart','keydown','input'].forEach(evt => {
            document.addEventListener(evt, resetInactivityTimer, {passive:true});
        });

        // si la musique n'a pas dÃ©marrÃ© Ã  cause de la politique du navigateur, retenter au premier click
        document.addEventListener('click', () => {
            if (!audioPlaying) {
                if (uploadedAudioEl) {
                    uploadedAudioEl.play().then(() => {
                        audioPlaying = true;
                        const btn = document.getElementById('audioToggle');
                        if (btn) btn.textContent = 'ðŸ”” Son: DÃ©sactiver';
                    }).catch(() => { startMusic(); });
                } else {
                    startMusic();
                }
            }
        }, { once: true });

        document.addEventListener('keydown', e => { 
            if (e.key === 'Enter') addName(); 
        });

        init();
    </script>
</body>
</html>